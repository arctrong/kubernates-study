<!DOCTYPE html>
<html>
<head><title>Namespaces</title>
<meta charset="utf-8">
<link rel="shortcut icon" type="image/png" href="pict/favicon.png"/>
<link rel="stylesheet" type="text/css" href="layout/styles.css"/>
<link rel="stylesheet" type="text/css" href="layout/layout.css"/>

<style>
.headerNavArrows {position: relative; top: 3px;}
</style>
</head>
<body>

<div class="header"><b style="margin-right:7px;"><span styles="">K8s</span></b><a class="header_item" href="about.html">About</a><a class="header_item" href="index_page.html">Index</a>

<a href="demo_project.html" title="Previous: Complete demo project"><img class="headerNavArrows" src="pict/previous_page_h18px.png"/></a>

<a href="ingress.html" title="Next: Ingresses"><img class="headerNavArrows" src="pict/next_page_h18px.png"/></a>


<span class="headerTitle">Namespaces</span>
</div>

<div class="sidebar">
    <table class="sidebarAligner">
        <tr><td valign="top">
            <div class="sidebar_item "><a href="about.html">About the course</a></div><div class="sidebar_item "><a href="index.html">Theory</a></div><div class="sidebar_item "><a href="installation.html">Working environment installation</a></div><div class="sidebar_item "><a href="kubectl_commands.html">Main Kubectl commands</a></div><div class="sidebar_item "><a href="yaml_config_file.html">YAML Configuration file</a></div><div class="sidebar_item "><a href="demo_project.html">Complete demo project</a></div><div class="sidebar_item selected"><a href="namespaces.html">Namespaces</a></div><div class="sidebar_item "><a href="ingress.html">Ingresses</a></div><div class="sidebar_item "><a href="helm.html">Helm Package Manager</a></div><div class="sidebar_item "><a href="volumes.html">Persisting Data with Volumes</a></div><div class="sidebar_item "><a href="stateful_sets.html">StatefulSets</a></div><div class="sidebar_item "><a href="services.html">Services</a></div>
            <h3>Side steps</h3>
            <div class="sidebar_item "><a href="external_access.html">Access external Services from outside the Minicube cluster</a></div>
        </td></tr>
        <tr><td class="bottom" valign="bottom">
            Generated by <a href="https://github.com/arctrong/md2html">md2html_py</a> 1.0.2
        </td></tr>
    </table>
</div>

<p style="font-size:44px;font-weight:bold;margin:0 0 30px 0;">Namespaces</p>

<!--METADATA {"title": "K8s Namespaces"} -->

<div class="toc">
<ul>
<li><a href="#what-is-a-namespace">What is a Namespace?</a></li>
<li><a href="#default-namespaces">Default Namespaces</a></li>
<li><a href="#create-a-namespace">Create a Namespace</a></li>
<li><a href="#why-to-use-namespaces">Why to use Namespaces?</a><ul>
<li><a href="#namespaces-group-components">Namespaces group components</a></li>
<li><a href="#name-scopes-for-multiple-teams">Name scopes for multiple teams</a></li>
<li><a href="#resource-sharing">Resource sharing</a></li>
<li><a href="#resource-limits">Resource limits</a></li>
</ul>
</li>
<li><a href="#characteristics-of-namespaces">Characteristics of Namespaces</a></li>
<li><a href="#create-components-in-namespaces">Create components in Namespaces</a></li>
<li><a href="#change-active-namespace">Change active Namespace</a></li>
</ul>
</div>
<hr />
<p><a name="index_entry_index_1"></a></p>
<h1 id="what-is-a-namespace">What is a Namespace?</h1>
<p><a href="https://youtu.be/X48VuDVv0do?t=6374">1:46:14</a></p>
<p>A <strong>Namespace</strong> may be thought as a virtual cluster inside a cluster.</p>
<hr />
<h1 id="default-namespaces">Default Namespaces</h1>
<pre class="highlight"><code class="language-shell">$ kubectl get namespaces
NAME                   STATUS   AGE
default                Active   3d17h
kube-node-lease        Active   3d17h
kube-public            Active   3d17h
kube-system            Active   3d17h
kubernetes-dashboard   Active   3d17h</code></pre>
<p><code>kubernetes-dashboard</code> namespace is specific to minikube installation. It's not present in a real
K8s cluster.</p>
<p><code>kube-system</code> is not for user's components and must not be modified by the users. It contains 
system processes, Master and Kubectl processes, etc.</p>
<p><code>kube-public</code> is for publicly accessible data like ConfigMap that contains cluster information
and is accessible even without authentication:</p>
<pre class="highlight"><code class="language-shell">$ kubectl cluster-info
Kubernetes control plane is running at https://192.168.49.2:8443
KubeDNS is running at https://192.168.49.2:8443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</code></pre>
<p><code>kube-node-lease</code> is present in the recent edition of K8s. Contains heartbeats of the Nodes. Each
Node has associated lease object in this Namespace, that determines the availability of the Node.</p>
<p><code>default</code> Namespace contains all created user's components if the other Namespaces are not created.</p>
<hr />
<h1 id="create-a-namespace">Create a Namespace</h1>
<pre class="highlight"><code class="language-shell">$ kubectl create namespace my-namespace
namespace/my-namespace created

$ kubectl get namespaces
NAME                   STATUS   AGE
.  .  .
my-namespace           Active   3s</code></pre>
<p>But it's probably better to create a Namespace using configuration files:</p>
<pre class="highlight"><code class="language-code">apiVersion: v1
kind: ConfigMap
metadata:
  name: mysql-configmap
  namespace: my-namespace
data:
  db_url: mysql-service.database</code></pre>
<hr />
<h1 id="why-to-use-namespaces">Why to use Namespaces?</h1>
<p><a href="https://youtu.be/X48VuDVv0do?t=6552">1:49:12</a></p>
<p>Also see K8s documentation, section
<a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">Namespaces</a>.</p>
<h2 id="namespaces-group-components">Namespaces group components</h2>
<p><img alt="" src="pict/namespaces_group_conponents_01.png" /></p>
<p>With one Namespace it's difficult to overview the architecture.</p>
<p><img alt="" src="pict/namespaces_group_conponents_02.png" /></p>
<p>According to the official
<a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">K8s documentation</a>
using Namespaces should not be considered for smaller projects with fewer users. Though even in 
smaller projects there may be common resources like logging and monitoring systems, and Namespaces
help to separate them for better overview.</p>
<h2 id="name-scopes-for-multiple-teams">Name scopes for multiple teams</h2>
<p><img alt="" src="pict/namespaces_name_scopes_01.png" /></p>
<p>If two teams develop different applications with (somehow) the same name then Namespaces
will prevent name conflicts and thus interference on deployment.</p>
<h2 id="resource-sharing">Resource sharing</h2>
<p><img alt="" src="pict/namespaces_share_components_01.png" /></p>
<p>We can use the same resources for the different development state deployments. I.e. we don't
need to include the common resources (such as databases) into each deployment. Such architecture
may be used in <a href="https://en.wikipedia.org/wiki/Blue-green_deployment">Blue-green deployment</a> when
there are two servers  and only one of them accepts external requests. The other is accessible 
only inside the company's internal network and is used for testing the changes. Then, when the 
changes are tested, the servers swap their roles.</p>
<h2 id="resource-limits">Resource limits</h2>
<p><img alt="" src="pict/namespaces_resource_restriction_01.png" /></p>
<p>Two teams may be prevented from interfering each other's projects. Also resource restrictions
(like CPU, RAM, storage, etc.) may be defined for a Namespace.</p>
<hr />
<h1 id="characteristics-of-namespaces">Characteristics of Namespaces</h1>
<p><a href="https://youtu.be/X48VuDVv0do?t=6907">1:55:07</a></p>
<p>Most components cannot be accessed across the Namespaces.</p>
<p><img alt="" src="pict/configmap_across_namespaces.png" /></p>
<p>Particularly, such components are ConfigMaps and Secrets. We need to create them for each
Namespace if required.</p>
<p>But Services <strong>can</strong> be shared across Namespaces. The references are done using the dot notation:</p>
<pre class="highlight"><code class="language-code">apiVersion: v1
kind: ConfigMap
.  .  .
data:
  db_url: mysql-service.database</code></pre>
<p>Here <code>mysql-service</code> is the Namespace and <code>database</code> is the Service.</p>
<p>Some components <strong>cannot</strong> be created within a Namespace, they must belong globally to the cluster 
only. Such components are Volumes and Nodes.</p>
<pre class="highlight"><code class="language-shell">$ kubectl api-resources --namespaced=true
NAME                        SHORTNAMES   APIVERSION         NAMESPACED   KIND
.  .  .                                                
configmaps                  cm           v1                 true         ConfigMap
pods                        po           v1                 true         Pod
secrets                                  v1                 true         Secret
services                    svc          v1                 true         Service
deployments                 deploy       apps/v1            true         Deployment
replicasets                 rs           apps/v1            true         ReplicaSet
statefulsets                sts          apps/v1            true         StatefulSet
.  .  .

$ kubectl api-resources --namespaced=false
NAME              SHORTNAMES   APIVERSION                   NAMESPACED   KIND
.  .  .                                           
namespaces        ns           v1                           false        Namespace
nodes             no           v1                           false        Node
.  .  .</code></pre>
<hr />
<h1 id="create-components-in-namespaces">Create components in Namespaces</h1>
<p><a href="https://youtu.be/X48VuDVv0do?t=7060">1:57:40</a></p>
<p>If we don't provide a Namespace like this (there's just a <code>name</code> element in <code>metadata</code>):</p>
<pre class="highlight"><code class="language-code">apiVersion: v1
kind: ConfigMap
metadata:
  name: mysql-configmap
data:
  db_url: mysql-service.database</code></pre>
<p>then the component is created in the <code>default</code> Namespace. Let's check it:</p>
<pre class="highlight"><code class="language-shell">$ vi mysql-configmap.yaml</code></pre>
<p>Add the ConfigMap content above:</p>
<pre class="highlight"><code class="language-shell">$ kubectl apply -f mysql-configmap.yaml
configmap/mysql-configmap created

$ kubectl get configmap -n default
NAME                DATA   AGE
mysql-configmap     1      76s

$ kubectl describe configmap mysql-configmap
Name:         mysql-configmap
Namespace:    default
.  .  .</code></pre>
<p>We can define the namespace on the component creation:</p>
<pre class="highlight"><code class="language-shell">$ kubectl apply -f mysql-configmap.yaml --namespace=my-namespace
configmap/mysql-configmap created

$ kubectl get configmap -n my-namespace
NAME               DATA   AGE
mysql-configmap    1      5m52s

$ kubectl describe configmap mysql-configmap -n my-namespace
Name:         mysql-configmap
Namespace:    my-namespace
.  .  .</code></pre>
<p>But this method is impractical. It's better to define the namespace in the configuration file 
metadata:</p>
<pre class="highlight"><code class="language-code">apiVersion: v1
kind: ConfigMap
metadata:
  name: mysql-configmap
  namespace: my-namespace
data:
  db_url: mysql-service.database</code></pre>
<pre class="highlight"><code class="language-shell">$ kubectl delete -f mysql-configmap.yaml
configmap "mysql-configmap" deleted

$ kubectl apply -f mysql-configmap.yaml
configmap/mysql-configmap created

$ kubectl get configmap -n my-namespace
NAME               DATA   AGE
mysql-configmap    1      79s</code></pre>
<p>This method gives more self-documented source code.</p>
<hr />
<h1 id="change-active-namespace">Change active Namespace</h1>
<p><a href="https://youtu.be/X48VuDVv0do?t=7204">2:00:04</a></p>
<p>Adding <code>-n my-namespace</code> to all command is inconvenient. But K8s and Kubectl doesn't have a
solution to set an active Namespace neither globally nor for a session.</p>
<p>There's a separate tool <code>kubens</code> that is provided with the other tool <code>kubectx</code>, see
<a href="https://github.com/ahmetb/kubectx">here</a>. But its installation process looks very unfriendly,
and it failed to install on Ubuntu. So I'm not going to use this tool in this course.</p>
<p>And this may be not a good idea to let a third-party tool intervene in every command of such a
complex process.</p>
<p>&nbsp;</p>
<hr />

<p style="margin-top:0px;margin-bottom:0px;text-align:right;"><a href="demo_project.html" 
title="Previous: Complete demo project"><img src="pict/previous_page.png"/></a>

<a href="ingress.html" title="Next: Ingresses"><img 
src="pict/next_page.png"/></a>
</p>

<div style="height: 1000px;"><p>&nbsp;</p></div>

</body>
</html>
