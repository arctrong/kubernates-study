<!DOCTYPE html>
<html>
<head><title>Access external Services from outside the Minicube cluster</title>
<meta charset="utf-8">
<link rel="shortcut icon" type="image/png" href="pict/favicon.png"/>
<link rel="stylesheet" type="text/css" href="layout/styles.css"/>
<link rel="stylesheet" type="text/css" href="layout/layout.css"/>

<style>
.headerNavArrows {position: relative; top: 3px;}
</style>
</head>
<body>

<div class="header"><b style="margin-right:7px;"><span styles="">K8s</span></b><a class="header_item" href="about.html">About</a><a class="header_item" href="index_page.html">Index</a><a class="header_item" href="https://github.com/arctrong/kubernates-study">GitHub</a>


<img class="headerNavArrows" src="pict/previous_page_h18px_inactive.png"/>

<img class="headerNavArrows" src="pict/next_page_h18px_inactive.png"/>

<span class="headerTitle">Access external Services from outside the Minicube cluster</span>
</div>

<div class="sidebar">
    <table class="sidebarAligner">
        <tr><td valign="top">
            <div class="sidebar_item "><a href="about.html">About the course</a></div><div class="sidebar_item "><a href="index.html">Theory</a></div><div class="sidebar_item "><a href="installation.html">Working environment installation</a></div><div class="sidebar_item "><a href="kubectl_commands.html">Main Kubectl commands</a></div><div class="sidebar_item "><a href="yaml_config_file.html">YAML Configuration file</a></div><div class="sidebar_item "><a href="demo_project.html">Complete demo project</a></div><div class="sidebar_item "><a href="namespaces.html">Namespaces</a></div><div class="sidebar_item "><a href="ingress.html">Ingresses</a></div><div class="sidebar_item "><a href="helm.html">Helm Package Manager</a></div><div class="sidebar_item "><a href="volumes.html">Persisting Data with Volumes</a></div><div class="sidebar_item "><a href="stateful_sets.html">StatefulSets</a></div><div class="sidebar_item "><a href="services.html">Services</a></div>
            <h3>Side steps</h3>
            <div class="sidebar_item selected"><a href="external_access.html">Access external Services from outside the Minicube cluster</a></div>
        </td></tr>
        <tr><td class="bottom" valign="bottom">
            Generated by <a href="https://github.com/arctrong/md2html">md2html_py</a> 1.0.2
        </td></tr>
    </table>
</div>

<p style="font-size:44px;font-weight:bold;margin:0 0 30px 0;">Access external Services from outside the Minicube cluster</p>

<!--METADATA {"title": "External access"} -->

<div class="toc">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#using-k8s-proxy">Using K8s proxy</a></li>
<li><a href="#using-nginx-request-forwarding">Using Nginx request forwarding</a></li>
<li><a href="#using-ingress-component">Using Ingress component</a></li>
</ul>
</div>
<hr />
<h1 id="introduction">Introduction</h1>
<p>The external Services running inside the minikube cluster are accessible only from the machine
on which the minikube is running. This may be inconvenient when working with a remote minikube
host machine. And sometimes it's impossible to access the Services from the host machine's
browser.</p>
<p>According to <a href="https://github.com/kubernetes/minikube/issues/8008">this</a> minikube cannot expose
external Services outside the cluster machine, and this functionality is not planned to be added.</p>
<p>This section discusses this problem solution methods.</p>
<blockquote>
<p>Also see K8s documentation section
<a href="https://minikube.sigs.k8s.io/docs/handbook/accessing/">Accessing apps</a>
for more details.</p>
<p>Later in the course <a href="ingress.html#create_ingress_rule">another method</a>
was discussed. But this method still uses external Nginx (or the other proxy server)
configuration.</p>
</blockquote>
<hr />
<p><a name="using_k8s_proxy"></a></p>
<h1 id="using-k8s-proxy">Using K8s proxy</h1>
<p>Built-in
<a href="https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/">K8s Dashboard</a>
will be used as an example.</p>
<p>According to this <a href="https://stackoverflow.com/a/53830578">Stackoverflow answer</a>:</p>
<pre class="highlight"><code class="language-shell">$ kubectl proxy --address='0.0.0.0' --disable-filter=true &amp;
[1] 13392
.  .  .
Starting to serve on [::]:8001

$ minikube dashboard --url=true &amp;
[2] 19679
* Verifying dashboard health ...
* Launching proxy ...
* Verifying proxy health ...

greg@deimos:~$ jobs
[1]-  Running                 kubectl proxy --address='0.0.0.0' --disable-filter=true &amp;
[2]+  Running                 minikube dashboard --url=true &amp;
http://127.0.0.1:40897/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/

$ jobs
[1]-  Running                 kubectl proxy --address='0.0.0.0' --disable-filter=true &amp;
[2]+  Running                 minikube dashboard --url=true &amp;</code></pre>
<blockquote>
<p>This jobs running in the background will output to the console interleaving with the current
activity output. If this is a problem, use redirection to <code>/dev/null</code> or to a file. Or
alternatively start this processes in separate terminal windows.</p>
</blockquote>
<p>Then find the minikube host IP address:</p>
<pre class="highlight"><code class="language-shell">$ hostname -I
192.168.1.500 ...</code></pre>
<p>And correct the URL accordingly:
<a href="http://192.168.1.500:8001/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/">http://192.168.1.500:8001/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/</a>.
Then this URL may be opened in a browser on the other machine.</p>
<p>To stop the background processes execute:</p>
<pre class="highlight"><code class="language-shell">$ kill %2
[2]+  Terminated              minikube dashboard --url=true

$ kill %1
[1]+  Terminated              kubectl proxy --address='0.0.0.0' --disable-filter=true

$ jobs
&lt;nothing&gt;</code></pre>
<p>or press <code>Ctrl</code>+<code>C</code> if the processes are running in the separate terminal windows.</p>
<hr />
<p><a name="index_entry_index_1"></a><a name="nginx_request_forwarding"></a></p>
<h1 id="using-nginx-request-forwarding">Using Nginx request forwarding</h1>
<p>For some reasons, the K8s proxy didn't work for the deployed user's project, particularly, for
the one with Mongo Express external Service. So <a href="https://www.nginx.com/">Nginx</a> is going to be
used for the requests forwarding. Nginx server was installed previously in the current working
Ubuntu Linux environment, so its installation is not discussed here.</p>
<p>The following command must be executed if it was not already done or after the minikube cluster
restart:</p>
<pre class="highlight"><code class="language-shell">$ kubectl get services
NAME                    TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE
.  .  .
mongo-express-service   LoadBalancer   10.101.164.221   &lt;pending&gt;     8081:30000/TCP   19h

$ minikube service mongo-express-service --url=true
http://192.168.49.2:30000</code></pre>
<p>The returned URL will be used later.</p>
<pre class="highlight"><code class="language-shell">$ less /etc/nginx/nginx.conf
.  .  .
http {
.  .  .
        include /etc/nginx/sites-enabled/*;
.  .  .

$ sudo vi /etc/nginx/sites-enabled/default</code></pre>
<p>Add another server (using the above URL):</p>
<pre class="highlight"><code>server {
        listen 8040;
        listen [::]:8040;

        root /var/www/html;

        # Add index.php to the list if you are using PHP
        index index.html index.htm index.nginx-debian.html;

        server_name _;

        location / {
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_pass http://192.168.49.2:30000;
        }
}</code></pre>
<p>Then restart the nginx service:</p>
<pre class="highlight"><code class="language-shell">$ sudo service nginx start

$ service nginx status
.  .  .
   Active: active (running) since Mon 2021-07-05 21:48:14 MSK; 7s ago
.  .  .

$ hostname -I
192.168.1.500 ...</code></pre>
<p>Then open the link <a href="">http://192.168.1.500:8040/</a> in a browser on the other machine.</p>
<hr />
<h1 id="using-ingress-component">Using Ingress component</h1>
<p>See <a href="ingress.html#create_ingress_rule">here</a>.</p>
<p>&nbsp;</p>
<hr />


<div style="height: 1000px;"><p>&nbsp;</p></div>

</body>
</html>
