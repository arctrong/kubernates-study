<!DOCTYPE html>
<html>
<head><title>Services</title>
<meta charset="utf-8">
<link rel="shortcut icon" type="image/png" href="pict/favicon.png"/>
<link rel="stylesheet" type="text/css" href="layout/styles.css"/>
<link rel="stylesheet" type="text/css" href="layout/layout.css"/>

<style>
.headerNavArrows {position: relative; top: 3px;}
</style>
</head>
<body>

<div class="header"><b style="margin-right:7px;"><span styles="">K8s</span></b><a class="header_item" href="about.html">About</a><a class="header_item" href="index_page.html">Index</a>

<a href="stateful_sets.html" title="Previous: StatefulSets"><img class="headerNavArrows" src="pict/previous_page_h18px.png"/></a>


<img class="headerNavArrows" src="pict/next_page_h18px_inactive.png"/>

<span class="headerTitle">Services</span>
</div>

<div class="sidebar">
    <table class="sidebarAligner">
        <tr><td valign="top">
            <div class="sidebar_item "><a href="about.html">About the course</a></div><div class="sidebar_item "><a href="index.html">Theory</a></div><div class="sidebar_item "><a href="installation.html">Working environment installation</a></div><div class="sidebar_item "><a href="kubectl_commands.html">Main Kubectl commands</a></div><div class="sidebar_item "><a href="yaml_config_file.html">YAML Configuration file</a></div><div class="sidebar_item "><a href="demo_project.html">Complete demo project</a></div><div class="sidebar_item "><a href="namespaces.html">Namespaces</a></div><div class="sidebar_item "><a href="ingress.html">Ingresses</a></div><div class="sidebar_item "><a href="helm.html">Helm Package Manager</a></div><div class="sidebar_item "><a href="volumes.html">Persisting Data with Volumes</a></div><div class="sidebar_item "><a href="stateful_sets.html">StatefulSets</a></div><div class="sidebar_item selected"><a href="services.html">Services</a></div>
            <h3>Side steps</h3>
            <div class="sidebar_item "><a href="external_access.html">Access external Services from outside the Minicube cluster</a></div>
        </td></tr>
        <tr><td class="bottom" valign="bottom">
            Generated by <a href="https://github.com/arctrong/md2html">md2html_py</a> 1.0.2
        </td></tr>
    </table>
</div>

<p style="font-size:44px;font-weight:bold;margin:0 0 30px 0;">Services</p>

<!--METADATA {"title": "K8s Services"} -->

<div class="toc">
<ul>
<li><a href="#services">Services</a></li>
<li><a href="#clusterip-services">ClusterIP Services</a></li>
<li><a href="#multi-port-services">Multi-Port Services</a></li>
<li><a href="#headless-services">Headless Services</a></li>
<li><a href="#nodeport-services">NodePort Services</a></li>
<li><a href="#loadbalancer-services">LoadBalancer Services</a></li>
<li><a href="#the-end">The end</a></li>
</ul>
</div>
<hr />
<p><a name="index_entry_index_1"></a></p>
<h1 id="services">Services</h1>
<p><a href="https://youtu.be/X48VuDVv0do?t=11623">3:13:43</a></p>
<p>Service types:</p>
<ul>
<li>ClusterIP;</li>
<li>NodePort;</li>
<li>Headless;</li>
<li>LoadBalancer.</li>
</ul>
<p>After a Pod recreation it obtains another IP address from the range defined for the Node.
The current Pod's IP address may be found the following way:</p>
<pre class="highlight"><code class="language-shell">$ kubectl get pods -o wide
NAME                                 READY   STATUS    RESTARTS   AGE   IP           NODE       NOMINATED NODE   READINESS GATES
mongo-express-78fcf796b8-5t7jf       1/1     Running   13         8d    172.17.0.5   minikube   &lt;none&gt;           &lt;none&gt;
mongodb-deployment-8f6675bc5-x2pzj   1/1     Running   5          8d    172.17.0.4   minikube   &lt;none&gt;           &lt;none&gt;</code></pre>
<p>Services provide stable IP addresses for the Pods. Also they do load balancing when a Pod is
replicated. They are abstraction that provides loose coupling within and outside the cluster.</p>
<hr />
<h1 id="clusterip-services">ClusterIP Services</h1>
<p><a href="https://youtu.be/X48VuDVv0do?t=11755">3:15:55</a></p>
<p>This is the default type. This is how it's used for the external access to the Pods:</p>
<p><img alt="" src="pict/cluster-ip-service.png" /></p>
<p>The Service port <code>3200</code> is defined in the Ingress config. The replicated Pod's port is defined in 
the Service config (<code>targetPort</code> attribute).</p>
<p>The Pods that the Service forwards to are defined using labels and selectors.</p>
<p><img alt="" src="pict/seervice-pod-selectors.png" /></p>
<p>The label keys may be arbitrary. If there are several selectors in a Service then it'll match the
Pods that have all corresponding labels.</p>
<p>Also K8s creates <strong>Endpoints</strong> with the same names as the corresponding Services:</p>
<pre class="highlight"><code class="language-shell">$ kubectl get endpoints
NAME                    ENDPOINTS           AGE
kubernetes              192.168.49.2:8443   11d
mongo-express           172.17.0.5:8080     8d
mongo-express-service   172.17.0.5:8081     8d
mongodb-service         172.17.0.4:27017    8d</code></pre>
<p>Endpoints keep track of which Pods are members/endpoints of the Service. When the Pod is recreated
the above information is updated.</p>
<hr />
<h1 id="multi-port-services">Multi-Port Services</h1>
<p><a href="https://youtu.be/X48VuDVv0do?t=12211">3:23:31</a></p>
<p>In the Service config the <code>port</code> parameter may be chosen arbitrarily but the <code>targetPort</code> must
match the port that's listened by the Pod.</p>
<p>A Service may have several ports (<code>port</code>&mdash;<code>targetPort</code> pairs). In this case the ports must be
named.</p>
<hr />
<h1 id="headless-services">Headless Services</h1>
<p><a href="https://youtu.be/X48VuDVv0do?t=12387">3:26:27</a></p>
<p>A client may want to communicate directly to a specific replica of a Pod. This may be needed
to request a stateful Pod (like a database) when Pod replicas are not identical. The master Node
(see <a href="stateful_sets.html#master_slave_pods">here</a>) is the only allowed for writing. When another
Pod is added it need to connect to the specific Pod for synchronization.</p>
<p>The first option to achieve this is using K8s specific API but this is inefficient.</p>
<p><img src="pict/headless-services.png" style="float: right; margin: 0 0 25px 25px;" /></p>

<p>The other option is using <strong>DNS Lookups</strong> for Service that returns a single IP address
(ClusterIP). In Service config we set parameter <code>spec/clusterIP</code> to <code>None</code>. Then the DNS server
will return the Pod IP address instead of the Service IP address.</p>
<p>In this case we adjust two Services. One for the usual use, and the other <strong>headless</strong> Service for
synchronization.</p>
<p style="clear: both;"></p>

<hr />
<h1 id="nodeport-services">NodePort Services</h1>
<p><a href="https://youtu.be/X48VuDVv0do?t=12663">3:31:03</a></p>
<p>Service with <code>type: NodePort</code> is accessible on a static port on each worker Node in a cluster.
This type of Services have additional attribute <code>nodePort</code> in configuration file. The range 
is <code>30000..32767</code>.</p>
<p>This option may cause security issues. May be used for testing purpose.</p>
<hr />
<h1 id="loadbalancer-services">LoadBalancer Services</h1>
<p><a href="https://youtu.be/X48VuDVv0do?t=12835">3:33:55</a></p>
<p>This approach uses the cloud provider load balancer. </p>
<p><img alt="" src="pict/load-balancer-service.png" /></p>
<p>When we create a Service with <code>type: LoadBalancer</code> the NodePort and ClusterIP Services are
created automatically.</p>
<hr />
<p><em>Jul 14, 2021</em></p>
<h1 id="the-end">The end</h1>
<p>This is the end!</p>
<p>&nbsp;</p>
<hr />

<p style="margin-top:0px;margin-bottom:0px;text-align:right;"><a href="stateful_sets.html" 
title="Previous: StatefulSets"><img src="pict/previous_page.png"/></a>


<img src="pict/next_page_inactive.png"/></p>

<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>

</body>
</html>
