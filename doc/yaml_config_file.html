<!DOCTYPE html>
<html>
<head><title>YAML Configuration file</title>
<meta charset="utf-8">
<link rel="shortcut icon" type="image/png" href="pict/favicon.png"/>
<link rel="stylesheet" type="text/css" href="styles.css"/>
<link rel="stylesheet" type="text/css" href="layout.css"/>

<style>
.headerNavArrows {position: relative; top: 3px;}
</style>
</head>
<body>

<div class="header"><b style="margin-right:7px;"><span styles="">K8s</span></b><a class="header_item" href="about.html">About</a>

<a href="kubectl_commands.html" title="Previous: Main Kubectl commands"><img class="headerNavArrows" src="pict/previous_page_h18px.png"/></a>

<a href="demo_project.html" title="Next: Complete demo project"><img class="headerNavArrows" src="pict/next_page_h18px.png"/></a>


<span class="headerTitle">YAML Configuration file</span>
</div>

<div class="sidebar">
    <table class="sidebarAligner">
        <tr><td valign="top">
            <h3>Sections</h3>
            <div class="sidebar_item "><a href="about.html">About the course</a></div><div class="sidebar_item "><a href="index.html">Theory</a></div><div class="sidebar_item "><a href="installation.html">Working environment installation</a></div><div class="sidebar_item "><a href="kubectl_commands.html">Main Kubectl commands</a></div><div class="sidebar_item selected"><a href="yaml_config_file.html">YAML Configuration file</a></div><div class="sidebar_item "><a href="demo_project.html">Complete demo project</a></div><div class="sidebar_item "><a href="namespaces.html">Namespaces</a></div><div class="sidebar_item "><a href="ingress.html">Ingresses</a></div><div class="sidebar_item "><a href="helm.html">Helm Package Manager</a></div><div class="sidebar_item "><a href="volumes.html">Persisting Data with Volumes</a></div><div class="sidebar_item "><a href="stateful_sets.html">StatefulSets</a></div><div class="sidebar_item "><a href="services.html">Services</a></div>
            <h3>Side steps</h3>
            <div class="sidebar_item "><a href="external_access.html">Access external Services from outside the Minicube cluster</a></div>
        </td></tr>
        <tr><td class="bottom" valign="bottom">
            Generated by md2html_py 1.0.0
            <br />2021-12-15 10:48:33
        </td></tr>
    </table>
</div>

<p style="font-size:44px;font-weight:bold;margin:0 0 30px 0;">YAML Configuration file</p>

<!--METADATA {"title": "K8s YAML Configuration File"} -->

<div class="toc">
<ul>
<li><a href="#three-parts-of-k8s-configuration-file">Three parts of K8s configuration file</a></li>
<li><a href="#format-of-configuration-file">Format of configuration file</a></li>
<li><a href="#blueprint-for-pods-template">Blueprint for Pods (template)</a></li>
<li><a href="#connecting-services-to-deployments-and-pods">Connecting Services to Deployments and Pods</a></li>
</ul>
</div>
<hr />
<h1 id="three-parts-of-k8s-configuration-file">Three parts of K8s configuration file</h1>
<p><a href="https://youtu.be/X48VuDVv0do?t=3723">1:02:03</a></p>
<p>See <a href="../provided/kubernetes-configuration-file-explained/nginx-deployment.yaml">nginx-deployment.yaml</a>
and <a href="../provided/kubernetes-configuration-file-explained/nginx-service.yaml">nginx-service.yaml</a>.</p>
<p><code>kind: Deployment</code> and <code>kind: Service</code> show what we are going to create.</p>
<ul>
<li>First part is <code>matadata:</code></li>
<li>Second part is specification (<code>spec:</code>). It is specific to the kind of the component.</li>
<li>Third part is <code>status:</code> &mdash; automatically generated and added by K8s. This is how K8s
    <strong>continuously</strong> tracks the desired and the actual states and makes decides about the
    self-healing.</li>
</ul>
<p>The <code>status</code> information is held in the <a href="index.html#master_node_processes">etcd</a>.</p>
<p>If we specify and apply <code>spec/replicas: 2</code> but actual is:</p>
<pre class="highlight"><code class="language-shell">$ kubectl get deployment nginx-deployment -o yaml | less
.  .  .
apiVersion: apps/v1
kind: Deployment
metadata:
.  .  .
  name: nginx-deployment
.  .  .
status:
  availableReplicas: 1
.  .  .</code></pre>
<p>Then K8s will see the problem and will try to create a new replica ASAP.</p>
<hr />
<h1 id="format-of-configuration-file">Format of configuration file</h1>
<p><a href="https://youtu.be/X48VuDVv0do?t=3938">1:05:38</a></p>
<p><strong>YAML</strong> (a recursive acronym for "<strong>YAML</strong> Ain't Markup Language"):
<a href="https://en.wikipedia.org/wiki/YAML">Wikipedia</a> |
<a href="https://yaml.org/">Official site</a>.</p>
<p>It's a good practice to store configuration files the code (see <a href="https://en.wikipedia.org/wiki/Infrastructure_as_code">IAAC, Infrastructure As Code,
concept</a>).</p>
<hr />
<h1 id="blueprint-for-pods-template">Blueprint for Pods (<code>template</code>)</h1>
<p><a href="https://youtu.be/X48VuDVv0do?t=4009">1:06:49</a></p>
<p><img src="pict/deployment_abstraction_layers.png" style="float: left; margin: 0 25px 25px 0;" /></p>

<p>Whenever we want to create a Pod we create a Deployment and K8s takes care of the rest.</p>
<p>See <a href="../provided/kubernetes-configuration-file-explained/nginx-deployment.yaml">nginx-deployment.yaml</a>,
<code>spec/template:</code>. The template also has its metadata and specification. So it's a configuration file
inside a configuration file. The latter configuration applies to a Pod, so it is the <strong>blueprint</strong>
for a Pod.</p>
<p style="clear: both;"></p>

<hr />
<h1 id="connecting-services-to-deployments-and-pods">Connecting Services to Deployments and Pods</h1>
<p><a href="https://youtu.be/X48VuDVv0do?t=4083">1:08:03</a></p>
<p>This is done using <strong>labels</strong> and <strong>selectors</strong>. Also see K8s documentation 
<a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/">Labels and Selectors</a>.</p>
<p><img alt="" src="pict/labels_and_selectors.png" /></p>
<p>See <a href="../provided/kubernetes-configuration-file-explained/nginx-deployment.yaml">nginx-deployment.yaml</a>
and <a href="../provided/kubernetes-configuration-file-explained/nginx-service.yaml">nginx-service.yaml</a>.</p>
<p><img src="pict/ports_01.png" style="float: left; margin: 0 25px 25px 0;" /></p>

<p><img alt="" src="pict/ports_02.png" /></p>
<p>So the Service will accept requests on the port <code>80</code> and forwards them the the to port <code>8080</code>
of the Pod.</p>
<p style="clear: both;"></p>

<p>Placing the YAML files into the working accessible directory and applying them:</p>
<pre class="highlight"><code class="language-shell">$ kubectl apply -f nginx-deployment.yaml
deployment.apps/nginx-deployment unchanged

$ kubectl apply -f nginx-service.yaml
service/nginx-service created</code></pre>
<p>Now getting more detailed information about the Pods:</p>
<pre class="highlight"><code class="language-shell">$ kubectl get pods -o wide
NAME                               READY   STATUS    RESTARTS   AGE   IP           NODE       NOMINATED NODE   READINESS GATES
nginx-deployment-f4b7bbcbc-6kbgw   1/1     Running   0          30h   172.17.0.5   minikube   &lt;none&gt;           &lt;none&gt;
nginx-deployment-f4b7bbcbc-gpffv   1/1     Running   0          31h   172.17.0.6   minikube   &lt;none&gt;           &lt;none&gt;</code></pre>
<p>Two pods as we have <code>replicas: 2</code>. Looking at the service:</p>
<pre class="highlight"><code class="language-shell">$ kubectl get services
NAME            TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE
kubernetes      ClusterIP   10.96.0.1        &lt;none&gt;        443/TCP   2d1h
nginx-service   ClusterIP   10.110.173.246   &lt;none&gt;        80/TCP    117s

$ kubectl describe service nginx-service
Name:              nginx-service
.  .  .
Selector:          app=nginx
.  .  .
TargetPort:        8080/TCP
Endpoints:         172.17.0.5:8080,172.17.0.6:8080
.  .  .</code></pre>
<p>Now let's look at the status (that is automatically generated):</p>
<pre class="highlight"><code class="language-shell">$ kubectl get deployment nginx-deployment -o yaml &gt; nginx-deployment-result.yaml

$ less nginx-deployment-result.yaml</code></pre>
<blockquote>
<p>This automatically generated configuration contains a lot of runtime data. So if we want to 
create a blueprint out of it then we need to clean it much.</p>
</blockquote>
<p>We can delete the components using configuration files:</p>
<pre class="highlight"><code class="language-shell">$ kubectl delete -f nginx-deployment.yaml
deployment.apps "nginx-deployment" deleted

$ kubectl delete -f nginx-service.yaml
service "nginx-service" deleted</code></pre>
<p>&nbsp;</p>
<hr />

<p style="margin-top:0px;margin-bottom:0px;text-align:right;"><a href="kubectl_commands.html" 
title="Previous: Main Kubectl commands"><img src="pict/previous_page.png"/></a>

<a href="demo_project.html" title="Next: Complete demo project"><img 
src="pict/next_page.png"/></a>
</p>

<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>

</body>
</html>
