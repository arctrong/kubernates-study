<!DOCTYPE html>
<html>
<head><title>K8s Ingresses</title>
<meta charset="utf-8">
<!-- <link rel="shortcut icon" type="image/png" href="pict/favicon.png"/> -->
<link rel="stylesheet" type="text/css" href="styles.css"/>
<link rel="stylesheet" type="text/css" href="layout.css"/>

</head>
<body>

<div class="header"><i>This is an automatically generated document.</i></div>
<div class="sidebar">
    <table class="sidebarAligner">
        <tr><td valign="top">
            
            <h3>Sections</h3>
            <p><a href="about.html">About the course</a></p>
            <p><a href="index.html">Theory</a></p>
            <p><a href="installation.html">Working environment installation</a></p>
            <p><a href="kubectl_commands.html">Main Kubectl commands</a></p>
            <p><a href="yaml_config_file.html">K8s YAML Configuration file</a></p>
            <p><a href="demo_project.html">Complete demo project</a></p>
            <p><a href="namespaces.html">K8s Namespaces</a></p>
            <p><a href="ingress.html">K8s Ingresses</a></p>
            
            <h3>Side steps</h3>
            <p><a href="external_access.html">Access external Services from outside the Minicube cluster</a></p>
            
        </td></tr>
        <tr><td class="bottom" valign="bottom">
            <i>Generated by md2html_py 0.1.2
            <br />2021-07-08 21:58:25</i>
        </td></tr>
    </table>
</div>

<p>[<a href="namespaces.html">BACK</a>]</p>
<hr />
<p><p style="font-size: 40px; font-weight: bold;">K8s Ingresses</p></p>
<div class="toc">
<ul>
<li><a href="#what-is-ingress">What is Ingress?</a></li>
<li><a href="#example-yaml">Example YAML</a></li>
<li><a href="#how-to-configure-ingress-in-the-cluster">How to configure Ingress in the cluster?</a></li>
<li><a href="#demo-configure-ingress-in-minikube">Demo: Configure Ingress in Minikube</a><ul>
<li><a href="#installing-ingress-controller-in-minikube">Installing Ingress Controller in Minikube</a></li>
<li><a href="#create-ingress-rule">Create Ingress rule</a></li>
</ul>
</li>
</ul>
</div>
<hr />
<h1 id="what-is-ingress">What is Ingress?</h1>
<p><a href="https://youtu.be/X48VuDVv0do?t=7312">2:01:52</a></p>
<p>K8s documentation: <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/">Ingress</a> 
and <a href="https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/">Ingress Controllers</a>.</p>
<p>A deployment with a UI application Pod and an <strong>external</strong> service that is accessible by the 
<strong>HTTP IP address</strong> and the port is good for prototyping. In the final project we want it to be
accessed by the <strong>domain name</strong> and <strong>HTTPS</strong> protocol.</p>
<p>With an Ingress we use an <strong>internal</strong> Service and isolate the rest part of the application from
communication outside the cluster.</p>
<p><img alt="" src="pict/ingress_introduction.png" /></p>
<hr />
<h1 id="example-yaml">Example YAML</h1>
<p><a href="https://youtu.be/X48VuDVv0do?t=7407">2:03:27</a></p>
<p>First, consider the setup with the external Service:</p>
<p><img alt="" src="pict/ingress_before.png" /></p>
<p>Then introducing an Ingress. For that we change the service type from external (<code>LoadBalancer</code>)
to internal (<code>ClusterIP</code>, by default):</p>
<p><img alt="" src="pict/ingress_after.png" /></p>
<p><code>paths:</code> section defines the paths inside the web-application. Here HTTP protocol is used. HTTPS
protocol will be introduced later in the course. Note that there's no <code>nodePort</code> in the internal
Service.</p>
<p>Now let's look at the <code>host</code> section.</p>
<p><img alt="" src="pict/ingress_entry_points.png" /></p>
<p><code>host: myapp.com</code>:</p>
<ul>
<li>must be a valid domain address;</li>
<li>represents an <strong>entry point</strong> of the K8s cluster. The entry point may be a Node inside the
    K8s cluster or a node outside the K8s cluster (the latter is not clear yet).</li>
</ul>
<hr />
<h1 id="how-to-configure-ingress-in-the-cluster">How to configure Ingress in the cluster?</h1>
<p><a href="https://youtu.be/X48VuDVv0do?t=7612">2:06:52</a></p>
<p>Just creating an Ingress component is not enough for the Ingress routing rules to work. In
addition we need an implementation for the Ingress. This implementation is called 
<strong>Ingress Controller</strong>. Ingress Controller is a Node or a set of Nodes that work in the K8s
cluster and actually evaluate and process the Ingress rules.</p>
<p><img alt="" src="pict/ingress_controller.png" /></p>
<p>There are multiple implementations of the Ingress Controller, see
<a href="https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/">here</a>
for the list of Ingress Controllers that is supported by Kubernates and by the third parties.</p>
<p>We'll be using NGINX Ingress Controller (<a href="https://github.com/kubernetes/ingress-nginx/">GitHub</a> |
<a href="https://kubernetes.github.io/ingress-nginx/deploy/baremetal/">Bare-metal considerations</a>).</p>
<p>Cloud service providers, like <a href="https://aws.amazon.com/">AWS</a>,
<a href="https://cloud.google.com/">Google Cloud</a>, <a href="https://www.linode.com/">Linode</a>, if they have
out-of-the-box K8s solutions, provide their own load balancers as entrypoints.</p>
<p><img src="pict/proxy_server.png" style="float: left; margin: 0 25px 25px 0;" /></p>
<p>If we deploy the cluster on the Bare Metal we need to configure entrypoints ourselves.
An entrypoint is a separate server (a Proxy Server) with public IP addresses and ports.</p>
<p>In both cases no Service inside the cluster is exposed outside.</p>
<p style="clear: both;"></p>

<hr />
<h1 id="demo-configure-ingress-in-minikube">Demo: Configure Ingress in Minikube</h1>
<p><a href="https://youtu.be/X48VuDVv0do?t=7935">2:12:15</a></p>
<h2 id="installing-ingress-controller-in-minikube">Installing Ingress Controller in Minikube</h2>
<pre class="highlight"><code class="language-shell">$ minikube addons enable ingress
  - Using image docker.io/jettech/kube-webhook-certgen:v1.5.1
  - Using image k8s.gcr.io/ingress-nginx/controller:v0.44.0
  - Using image docker.io/jettech/kube-webhook-certgen:v1.5.1
* Verifying ingress addon...
* The 'ingress' addon is enabled</code></pre>

<p>This automatically starts the K8s Nginx implementation in Ingress Controller
(<a href="https://github.com/kubernetes/ingress-nginx/">GitHub</a> |
<a href="https://kubernetes.github.io/ingress-nginx/deploy/baremetal/">Bare-metal considerations</a>). This
implementation may be safely used in production environment as well.</p>
<pre class="highlight"><code class="language-shell">$ kubectl get pods -n ingress-nginx
NAME                                        READY   STATUS      RESTARTS   AGE
.  .  .
ingress-nginx-controller-5d88495688-zvlp5   1/1     Running     0          7m10s</code></pre>

<h2 id="create-ingress-rule">Create Ingress rule</h2>
<p><a href="https://www.youtube.com/watch?v=X48VuDVv0do&amp;t=7935s">2:13:17</a></p>
<p>We will create Ingress rule for the K8s Dashboard component.</p>
<pre class="highlight"><code class="language-shell">$ kubectl get ns
NAME                   STATUS   AGE
.  .  .
kubernetes-dashboard   Active   5d23h</code></pre>

<p>In Minikube it's installed by default but is not accessible externally.</p>
<pre class="highlight"><code class="language-shell">$ kubectl get all -n kubernetes-dashboard
NAME                                            READY   STATUS    RESTARTS   AGE
.  .  .
pod/kubernetes-dashboard-968bcb79-whw6n         1/1     Running   11         5d23h
.  .  .
NAME                                TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
.  .  .
service/kubernetes-dashboard        ClusterIP   10.104.85.224   &lt;none&gt;        80/TCP     5d23h
.  .  .</code></pre>

<p>As we can see, the Service is internal (with type <code>ClusterIP</code>).</p>
<p>Creating an ingress rule:</p>
<pre class="highlight"><code class="language-shell">ingress_demo$ vi dashboard-ingress.yaml</code></pre>

<p>Add the content of the file
<a href="../provided/kubernetes-ingress/dashboard-ingress.yaml"><code>dashboard-ingress.yaml</code></a>.</p>
<pre class="highlight"><code class="language-shell">$ kubectl apply -f dashboard-ingress.yaml
Warning: networking.k8s.io/v1beta1 Ingress is deprecated in v1.19+, unavailable in v1.22+; use networking.k8s.io/v1 Ingress
ingress.networking.k8s.io/dashboard-ingress created</code></pre>

<blockquote>
<p>See <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/#the-ingress-resource">here</a>
for the new format example. Now using the old one in order to save time.</p>
</blockquote>
<pre class="highlight"><code class="language-shell">$ kubectl get ingress -n kubernetes-dashboard
NAME                CLASS    HOSTS           ADDRESS        PORTS   AGE
dashboard-ingress   &lt;none&gt;   dashboard.com   192.168.49.2   80      8m43s</code></pre>

<p>So we see that the address was assigned.</p>
<p><a href="https://youtu.be/X48VuDVv0do?t=8197">2:16:37</a></p>
<hr />
<p>[<a href="namespaces.html">BACK</a>]</p>
<hr />
<hr />
<hr />
<hr />
<hr />

</body>
</html>
