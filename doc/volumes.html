<!DOCTYPE html>
<html>
<head><title>Persisting Data with Volumes</title>
<meta charset="utf-8">
<link rel="shortcut icon" type="image/png" href="pict/favicon.png"/>
<link rel="stylesheet" type="text/css" href="layout/styles.css"/>
<link rel="stylesheet" type="text/css" href="layout/layout.css"/>

<style>
.headerNavArrows {position: relative; top: 3px;}
</style>
</head>
<body>

<div class="header"><b style="margin-right:7px;"><span styles="">K8s</span></b><a class="header_item" href="about.html">About</a><a class="header_item" href="index_page.html">Index</a>

<a href="helm.html" title="Previous: Helm Package Manager"><img class="headerNavArrows" src="pict/previous_page_h18px.png"/></a>

<a href="stateful_sets.html" title="Next: StatefulSets"><img class="headerNavArrows" src="pict/next_page_h18px.png"/></a>


<span class="headerTitle">Persisting Data with Volumes</span>
</div>

<div class="sidebar">
    <table class="sidebarAligner">
        <tr><td valign="top">
            <div class="sidebar_item "><a href="about.html">About the course</a></div><div class="sidebar_item "><a href="index.html">Theory</a></div><div class="sidebar_item "><a href="installation.html">Working environment installation</a></div><div class="sidebar_item "><a href="kubectl_commands.html">Main Kubectl commands</a></div><div class="sidebar_item "><a href="yaml_config_file.html">YAML Configuration file</a></div><div class="sidebar_item "><a href="demo_project.html">Complete demo project</a></div><div class="sidebar_item "><a href="namespaces.html">Namespaces</a></div><div class="sidebar_item "><a href="ingress.html">Ingresses</a></div><div class="sidebar_item "><a href="helm.html">Helm Package Manager</a></div><div class="sidebar_item selected"><a href="volumes.html">Persisting Data with Volumes</a></div><div class="sidebar_item "><a href="stateful_sets.html">StatefulSets</a></div><div class="sidebar_item "><a href="services.html">Services</a></div>
            <h3>Side steps</h3>
            <div class="sidebar_item "><a href="external_access.html">Access external Services from outside the Minicube cluster</a></div>
        </td></tr>
        <tr><td class="bottom" valign="bottom">
            Generated by <a href="https://github.com/arctrong/md2html">md2html_py</a> 1.0.2
        </td></tr>
    </table>
</div>

<p style="font-size:44px;font-weight:bold;margin:0 0 30px 0;">Persisting Data with Volumes</p>

<!--METADATA {"title": "K8s Volumes"} -->

<div class="toc">
<ul>
<li><a href="#k8s-volumes">K8s Volumes</a><ul>
<li><a href="#storage-requirements">Storage requirements</a></li>
</ul>
</li>
<li><a href="#persistent-volume">Persistent Volume</a></li>
<li><a href="#persistence-volume-claims">Persistence Volume Claims</a></li>
<li><a href="#configmap-and-secret-as-volume-types">ConfigMap and Secret as volume types</a></li>
<li><a href="#storage-classes">Storage Classes</a></li>
</ul>
</div>
<hr />
<p><a name="index_entry_index_1"></a></p>
<h1 id="k8s-volumes">K8s Volumes</h1>
<p><a href="https://www.youtube.com/watch?v=X48VuDVv0do&amp;t=9345s">2:38:08</a></p>
<p><img src="pict/volumes_problem.png" style="float: left; margin: 0 25px 25px 0;" /></p>

<p>K8s has no persistence out of the box. So we need to make extra adjustments in order to keep the
data between the Pods restarts. This may be required for databases and shared directories.</p>
<p style="clear: both;"></p>

<p>We will discuss three components:</p>
<ul>
<li>Persistent Volume (PV)</li>
<li>Persistent Volume Claim (PVC)</li>
<li>Storage Class (SC)</li>
</ul>
<h2 id="storage-requirements">Storage requirements</h2>
<ol>
<li>Storage doesn't depend on the Pod lifecycle.</li>
<li>Storage must me available on all Nodes (as we don't know in which Node the Pod will start).</li>
<li>Storage must survive even if the cluster crashes.</li>
</ol>
<hr />
<h1 id="persistent-volume">Persistent Volume</h1>
<p><a href="https://youtu.be/X48VuDVv0do?t=9614">2:40:14</a></p>
<p>K8s documentation:
<a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#types-of-persistent-volumes">Persistent Volumes</a>.</p>
<p><img src="pict/pv_config.png" style="float: right; margin: 0 0 25px 25px;" /></p>

<p><strong>Persistent Volume (PV)</strong> may be thought as a cluster resource (like RAM or CPU) that is used
to store data. It's created via YAML file (<code>kind: PersistentVolume</code>). It defines parameters like
storage space amount but doesn't define the parameter of its actual allocation (local disk inside
the cluster, external NFS, or Cloud storage).</p>
<p>K8s doesn't care about the actual storage. It provides us a PV as abstraction and let us take
care about the storage backend (allocation, backup and restore, etc.).</p>
<p>See the documentation section above for the examples of configuration files. Also see K8s
documentation section
<a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#types-of-persistent-volumes">Types of Persistent Volumes</a>
for the list of the supported backends.</p>
<p>Note that PVs are not namespaced. So they are accessible to all components in all Namespaces.</p>
<p style="clear: both;"></p>

<hr />
<p><a name="index_entry_index_2"></a></p>
<h1 id="persistence-volume-claims">Persistence Volume Claims</h1>
<p><a href="https://youtu.be/X48VuDVv0do?t=9875">2:44:35</a></p>
<p>K8s documentation: <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#introduction">Persistent Volumes,
Introduction</a>.</p>
<p><strong>Local</strong> volumes violate requirements 2 and 3 (see above), so for databases persistence 
<strong>remote</strong> storage must be used.</p>
<p>K8s <strong>Admins</strong> set up the cluster and assures it has enough resources. K8s <strong>Users</strong> deploy
applications. So Admins configure the physical storage (like local, NFS and cloud) and make it
available inside the cluster. They also configure PVs for the storage backends. The Users
configure Pods to reference the configured PVs.</p>
<p><img alt="" src="pict/pvc_usage.png" /></p>
<p>Applications <strong>claim</strong> the PVs using <strong>Persistence Volume Claim (PVC)</strong> components. Configuration
files for these components have <code>type: PersistenceVolumeClaim</code>. A PVC must exist in the same
Namespace as the Pod that references this PVC. In the Pod's container the actual path to the
storage location is mounted.</p>
<p>These levels of abstractions help distribute responsibilities between Admins and Users.</p>
<hr />
<h1 id="configmap-and-secret-as-volume-types">ConfigMap and Secret as volume types</h1>
<p><a href="https://youtu.be/X48VuDVv0do?t=10288">2:51:28</a></p>
<p><img src="pict/config_map_volume.png" style="float: right; margin: 0 0 25px 25px;" /></p>

<p>They are:</p>
<ul>
<li>local volumes;</li>
<li>not created using PV and PVC components;</li>
<li>managed by K8s.</li>
</ul>
<p>Assume we need a certificate file (not a certificate as a binary object) mounted inside a Pod.
Or some application configuration need to be represented as files. In this case we create
ConfigMaps and/or Secrets and mount them as Volumes inside the container.</p>
<p style="clear: both;"></p>

<hr />
<h1 id="storage-classes">Storage Classes</h1>
<p><a href="https://youtu.be/X48VuDVv0do?t=10500">2:55:00</a></p>
<p>K8s documentation:
<a href="https://kubernetes.io/docs/concepts/storage/storage-classes/">Storage Classes</a>.</p>
<p><img alt="" src="pict/storage_classes.png" /></p>
<p><img src="pict/storage_class.png" style="float: right; margin: 0 0 25px 25px;" /></p>

<p>With many Pods, creating and managing external PersistentStorage components and their
corresponding backends may be to hard or impossible. To make this process more efficient another
component called <strong>StorageClass (SC)</strong> is used. SC provisions PersistentVolumes <strong>dynamically</strong>
when PVC claims it. It's created with configuration file with <code>type: StorageClass</code>.</p>
<p>SC is another abstraction level that defines:</p>
<ul>
<li>the underlying storage provider;</li>
<li>parameters for the storage.</li>
</ul>
<p>The SC is referenced from the PVC YAML file.</p>
<p style="clear: both;"></p>
<p>&nbsp;</p>
<hr />

<p style="margin-top:0px;margin-bottom:0px;text-align:right;"><a href="helm.html" 
title="Previous: Helm Package Manager"><img src="pict/previous_page.png"/></a>

<a href="stateful_sets.html" title="Next: StatefulSets"><img 
src="pict/next_page.png"/></a>
</p>

<div style="height: 1000px;"><p>&nbsp;</p></div>

</body>
</html>
