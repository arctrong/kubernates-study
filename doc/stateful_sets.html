<!DOCTYPE html>
<html>
<head><title>K8s StatefulSets</title>
<meta charset="utf-8">
<!-- <link rel="shortcut icon" type="image/png" href="pict/favicon.png"/> -->
<link rel="stylesheet" type="text/css" href="styles.css"/>
<link rel="stylesheet" type="text/css" href="layout.css"/>

</head>
<body>

<div class="header"><i>This is an automatically generated document.</i></div>
<div class="sidebar">
    <table class="sidebarAligner">
        <tr><td valign="top">
            
            <h3>Sections</h3>
            <p><a href="about.html">About the course</a></p>
            <p><a href="index.html">Theory</a></p>
            <p><a href="installation.html">Working environment installation</a></p>
            <p><a href="kubectl_commands.html">Main Kubectl commands</a></p>
            <p><a href="yaml_config_file.html">YAML Configuration file</a></p>
            <p><a href="demo_project.html">Complete demo project</a></p>
            <p><a href="namespaces.html">Namespaces</a></p>
            <p><a href="ingress.html">Ingresses</a></p>
            <p><a href="helm.html">Helm Package Manager</a></p>
            <p><a href="volumes.html">Persisting Data with Volumes</a></p>
            <p><a href="stateful_sets.html">StatefulSets</a></p>
            <p><a href="services.html">Services</a></p>
            
            <h3>Side steps</h3>
            <p><a href="external_access.html">Access external Services from outside the Minicube cluster</a></p>
            
        </td></tr>
        <tr><td class="bottom" valign="bottom">
            <i>Generated by md2html_py 0.1.2
            <br />2021-07-14 10:04:25</i>
        </td></tr>
    </table>
</div>

<p>[<a href="volumes.html">BACK</a>] | [<a href="services.html">NEXT</a>]</p>
<hr />
<p><p style="font-size: 40px; font-weight: bold;">K8s StatefulSets</p></p>
<div class="toc">
<ul>
<li><a href="#k8s-statefulsets">K8s StatefulSets</a></li>
<li><a href="#deployment-vs-statefulset">Deployment vs StatefulSet</a></li>
</ul>
</div>
<hr />
<h1 id="k8s-statefulsets">K8s StatefulSets</h1>
<p><a href="https://youtu.be/X48VuDVv0do?t=10718">2:58:38</a></p>
<p><img src="pict/stateful_and_stateless_apps.png" style="float: right; margin: 0 0 25px 25px;" /></p>
<p><strong>StatefulSet</strong> is used specifically for <strong>stateful</strong> applications (like databases and other
applications that store data to keep track of its state).</p>
<p><strong>Stateless</strong> applications don't keep record of state and consider each request as completely new.
They may connect stateful application to forward their requests.</p>
<p>Stateless applications are deployed using Deployment components.</p>
<p>Stateful applications are deployed using <strong>StatefulSet</strong> components.</p>
<p>The both components manage Pods based on container specification. The storage is configured the
same for both of them.</p>
<p style="clear: both;"></p>

<hr />
<h1 id="deployment-vs-statefulset">Deployment vs StatefulSet</h1>
<p><a href="https://youtu.be/X48VuDVv0do?t=10918">3:01:58</a></p>
<p><img src="pict/stateless_app_replication.png" style="float: right; margin: 0 0 25px 25px;" /></p>
<p>With a <strong>stateless</strong> application:</p>
<ul>
<li>Pods are identical and interchangeable; </li>
<li>Pods are created in random order and with random IDs (hashes);</li>
<li>the Service load balances to any Pod.</li>
</ul>
<p style="clear: both;"></p>

<p>Replicating <strong>stateful application</strong> is more difficult. It has different requirements. The
replica Pods:</p>
<ul>
<li>cannot be created/deleted at the same time;</li>
<li>cannot be randomly addressed;</li>
<li>are not identical and individual identity.</li>
</ul>
<p>Here's how stateful application replication is done:</p>
<p><a name="master_slave_pods"></a></p>
<p><img alt="" src="pict/stateful_app_replication.png" /></p>
<p>Master Pod can read and write while worker (slave) Pods can only read data. And after the master
changes data the workers don't read their storage before synchronization is done. If a new worker
Pod is added it clones its state from the previous (not any) Pod and then becomes available.
With this schema the data will survive even if all Pods die.</p>
<p>To make it work a Persistence Volume contains information about the Pod identity state (whether
it's a master or a slave). And it's important to use remote storage because the Pod may be
restored on the other Node and the storage must be accessible to it anyway.</p>
<p>StatefulSet Pods have fixed ordered names in format <code>${StatefulSet name}-${ordinal}</code>. The first
Pod is the master and the rest are the slaves in their start order. The next Pod is created if
the previous one is up and running. The Pod deletion is done in the reverse order and also
one by one.</p>
<p><img src="pict/stateful-set-endpoints.png" style="float: right; margin: 0 0 25px 25px;" /></p>
<p>A StatefulSet Pod has two endpoints. The first is the same as for a Deployment. The second is
DNS name in format <code>${pod name}.${governing service domain}</code>.</p>
<p>So when a Pod restarts the IP address changes but the endpoint stays the same. So Pod has
<em>sticky</em> identity.</p>
<p style="clear: both;"></p>

<blockquote>
<p><strong>Note.</strong> Replicating stateful apps is a complex task. K8s helps but there are a lot of things
to be done by the maintainer:</p>
<ul>
<li>Configuring the cloning and data synchronization.</li>
<li>Making remote storage available.</li>
<li>Managing back up.</li>
</ul>
<p>That's because stateful apps are not perfect for containerized environment.</p>
</blockquote>
<hr />
<p>[<a href="volumes.html">BACK</a>] | [<a href="services.html">NEXT</a>]</p>
<hr />
<hr />
<hr />
<hr />
<hr />

</body>
</html>
